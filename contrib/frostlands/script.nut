
//asset stuffs
print("Loading Frostlands overhauled PT2")

//music

::musfreeze <- "contrib/frostlands/music/freezingpoint.ogg"
::musjt <- "contrib/frostlands/music/race1-jt.ogg"
::musball <- "contrib/frostlands/music/city-theme.ogg"
::musballA <- "contrib/frostlands/music/grass-theme.ogg"
::mussal <- "contrib/frostlands/music/salcon.ogg"
::musair <- "contrib/frostlands/music/fried-air.ogg"
::musSUW <- "contrib/frostlands/music/STK-subsea.ogg"
::musSV <- "contrib/frostlands/music/STK-valley.ogg"

//visual assets
::bgAuroraALT <- newSprite("contrib/frostlands/gfx/BG/aurora-alt.png", 720, 240, 0, 0, 0, 0)
::bgSnowPlainALT <- newSprite("contrib/frostlands/gfx/BG/bgSnowPlain-alt.png", 720, 240, 0, 0, 0, 0)
::bgSnowNever <- newSprite("contrib/frostlands/gfx/BG/Anever.png", 720, 240, 0, 0, 0, 0)
::bgGrassNever <- newSprite("contrib/frostlands/gfx/BG/Bnever.png", 1024, 240, 0, 0, 0, 0)
::bgNightAlt <- newSprite("contrib/frostlands/gfx/BG/bgSnowNight-alt.png", 720, 240, 0, 0, 0, 0)
::bgRace <- newSprite("contrib/frostlands/gfx/BG/tuxracer.png", 520, 240, 0, 0, 0, 0)
::bgRace2 <- newSprite("contrib/frostlands/gfx/BG/tuxracer2.png", 520, 240, 0, 0, 0, 0)
::bgError <- newSprite("contrib/frostlands/gfx/BG/glitch.png", 1140, 240, 0, 0, 0, 0)
::sprC1 <- newSprite("contrib/frostlands/gfx/effects/star1.png", 7, 7, 0, 0, 3, 3)
//snow
::bgAuroraHill <- newSprite("contrib/frostlands/gfx/BG/hills-aurora1.png", 720, 240, 0, 0, 0, 0)
::bgAuroraHill1 <- newSprite("contrib/frostlands/gfx/BG/hills-aurora2.png", 720, 240, 0, 0, 0, 0)
::bgStarHill <- newSprite("contrib/frostlands/gfx/BG/night-hill.png", 720, 240, 0, 0, 0, 0)
::bgStarHill2 <- newSprite("contrib/frostlands/gfx/BG/night-hill2.png", 720, 240, 0, 0, 0, 0)
::bgSnowday <- newSprite("contrib/frostlands/gfx/BG/Snow-day.png", 720, 240, 0, 0, 0, 0)
::bgSnowDusk <- newSprite("contrib/frostlands/gfx/BG/Snow-dusk.png", 720, 240, 0, 0, 0, 0)
::bgSnowstars2 <- newSprite("contrib/frostlands/gfx/BG/Snow-stars2.png", 720, 240, 0, 0, 0, 0)
::bgPlainHill <- newSprite("contrib/frostlands/gfx/BG/plain-hill.png", 720, 240, 0, 0, 0, 0)
::bgPlainill2 <- newSprite("contrib/frostlands/gfx/BG/plain-hill1.png", 720, 240, 0, 0, 0, 0)
//forest
::bgForestday <- newSprite("contrib/frostlands/gfx/BG/Forest-1.png", 720, 240, 0, 0, 0, 0)
::bgForesttree1<- newSprite("contrib/frostlands/gfx/BG/Forest-2.png", 720, 240, 0, 0, 0, 0)
::bgForesttree2 <- newSprite("contrib/frostlands/gfx/BG/Forest-3.png", 720, 240, 0, 0, 0, 0)
//tropic
::bgFtropic <- newSprite("contrib/frostlands/gfx/BG/TropicalF.png", 720, 240, 0, 0, 0, 0)
::bgFtropic2 <- newSprite("contrib/frostlands/gfx/BG/TropicalFsun.png", 720, 240, 0, 0, 0, 0)
::bgFtropic3 <- newSprite("contrib/frostlands/gfx/BG/TropicalF2.png", 720, 240, 0, 0, 0, 0)
::bgFtropic0 <- newSprite("contrib/frostlands/gfx/BG/TropicalF0.png", 720, 240, 0, 0, 0, 0)
::bgFtropicM <- newSprite("contrib/frostlands/gfx/BG/tropics-mountans.png", 720, 240, 0, 0, 0, 0)

//NPCS
::sprTinyFireGuinb <- newSprite("contrib/frostlands/gfx/NPC/ash.png", 13, 23, 0, 0, 6, 23)
::sprRKO <- newSprite("contrib/frostlands/gfx/NPC/Rico.png", 18, 46, 0, 0, 9, 46)
::sprmark <- newSprite("contrib/frostlands/gfx/NPC/mark.png", 63, 48, 0, 0, 32, 47)
::sprmarq <- newSprite("contrib/frostlands/gfx/NPC/marqies.png", 53, 40, 0, 0, 26, 40)
::sprharo <- newSprite("contrib/frostlands/gfx/NPC/harold.png", 44, 43, 0, 0, 22, 43)
::sprTuckles2 <- newSprite("contrib/frostlands/gfx/NPC/tuckles2.png", 18, 34, 0, 0, 8, 34)
::sprFL <- newSprite("contrib/frostlands/gfx/NPC/flameC.png", 19, 52, 0, 0, 8, 52)
::sprterryB <- newSprite("contrib/frostlands/gfx/NPC/terry.png", 37, 51, 0, 0, 16, 51)
::sprNJ <- newSprite("contrib/frostlands/gfx/NPC/ninjarun.png", 19, 18, 0, 0, 19, 18)
::sprPX <- newSprite("contrib/frostlands/gfx/NPC/pix.png", 18, 16, 0, 0, 9, 16)
::sprP <- newSprite("contrib/frostlands/gfx/NPC/placeholder.png", 37, 51, 0, 0, 16, 51)
::sprTheo <- newSprite("contrib/frostlands/gfx/NPC/Theo.png", 21, 47, 0, 0, 16, 51)
::sprMPlayer <- newSprite("contrib/frostlands/gfx/NPC/minetest-player.png", 16, 33, 0, 0, 8, 33)
::sprPolyman <- newSprite("contrib/frostlands/gfx/NPC/polyman.png", 37, 51, 0, 0, 16, 51)

//OG style
::sprFlowerFireOG <- newSprite("contrib/frostlands/gfx/obj/fl-fireflower.png", 16, 16, 0, 0, 8, 8)
::sprFlowerIceOG <- newSprite("contrib/frostlands/gfx/obj/fl-iceflower.png", 16, 16, 0, 0, 8, 8)
::sprEarthShellOG <- newSprite("contrib/frostlands/gfx/obj/fl-earthshell.png", 16, 16, 0, 0, 8, 8)
::sprInfoBoxOG <- newSprite("contrib/frostlands/gfx/obj/fl-infobox.png", 16, 16, 0, 0, 0, 0)
::sprTriggerBoxOG <- newSprite("contrib/frostlands/gfx/obj/fl-redbox.png", 16, 16, 0, 0, 0, 0)
::sprItemBoxOG <- newSprite("contrib/frostlands/gfx/obj/fl-itembox.png", 16, 16, 0, 0, 0, 0)
::sprSnowballOG <- newSprite("contrib/frostlands/gfx/obj/fl-snowball.png", 16, 16, 0, 0, 8, 8)
::sprStarOG <- newSprite("contrib/frostlands/gfx/obj/fl-star.png", 16, 16, 0, 0, 8, 8)
::sprDarkOG <- newSprite("contrib/frostlands/gfx/obj/fl-darknyan.png", 16, 16, 0, 0, 8, 8)
::sprWoodBoxOG <- newSprite("contrib/frostlands/gfx/obj/fl-woodbox.png", 16, 16, 0, 0, 0, 0)
::sprWoodChunksOG <- newSprite("contrib/frostlands/gfx/obj/fl-woodchunks.png", 8, 8, 0, 0, 4, 4)
::sprCoinN1 <- newSprite("contrib/frostlands/gfx/obj/coin-n1.png", 16, 16, 0, 0, 8, 8)
::sprCoinN5 <- newSprite("contrib/frostlands/gfx/obj/coin-n5.png", 16, 16, 0, 0, 8, 8)
::sprCoinN10 <- newSprite("contrib/frostlands/gfx/obj/coin-n10.png", 16, 16, 0, 0, 8, 8)
::sprEmptyBoxOG <- newSprite("contrib/frostlands/gfx/obj/fl-emptybox.png", 16, 16, 0, 0, 0, 0)

::sprHealthFL <- newSprite("contrib/frostlands/gfx/fl-health.png", 16, 16, 0, 0, 0, 0)
::sprEnergyFl <- newSprite("contrib/frostlands/gfx/fl-energy.png", 16, 16, 0, 0, 0, 0)
::sprSubItemFL <- newSprite("contrib/frostlands/gfx/fl-itemcard.png", 20, 20, 0, 0, 10, 10)
::sprColorSwitchFL <- newSprite("contrib/frostlands/gfx/obj/colorswitches.png", 32, 32, 0, 0, 16, 16)
::sprColorBlockFL <- newSprite("contrib/frostlands/gfx/switchblocks.png", 16, 16, 0, 0, 0, 0)

::gfxOverrideFL <- function(never = false) {
	sprWoodBox = sprWoodBoxOG
	sprWoodChunks = sprWoodChunksOG


	sprFlowerFire = sprFlowerFireOG
	sprFlowerIce = sprFlowerIceOG
	sprEarthShell = sprEarthShellOG
	sprStar = sprStarOG
	sprDarkStar = sprDarkOG

	sprBoxInfo = sprInfoBoxOG
	sprBoxItem = sprItemBoxOG
	sprBoxEmpty = sprEmptyBoxOG
	sprBoxRed = sprTriggerBoxOG

	sprHealth = sprHealthFL
	sprEnergy = sprEnergyFl
	sprSubItem = sprSubItemFL
	sprColorSwitch = sprColorSwitchFL
	sprColorBlock = sprColorBlockFL

	if(never) {
		sprCoin = sprCoinN1
		sprCoin5 = sprCoinN5
		sprCoin10 = sprCoinN10
		} 
}

//background shiz

::dbgForestF <- function() {
	for(local i = 0; i < 2; i++) {
		drawSprite(bgForestday, 0, ((-camx / 16) % 720) + (i * 720), screenH() - 240)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgForesttree2, 0, ((-camx / 8) % 720) + (i * 720), screenH() - 240)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgForesttree1 0, ((-camx / 4) % 720) + (i * 720), screenH() - 240)
	}
}

::dbgAuroraF <- function() {
	for(local i = 0; i < 2; i++) {
		drawSprite(bgSnowday, 0, ((-camx / 16) % 720) + (i * 720), screenH() - 240)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgAuroraHill1, 0, ((-camx / 8) % 720) + (i * 720), screenH() - 240)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgAuroraHill, 0, ((-camx / 4) % 720) + (i * 720), screenH() - 240)
	}
}

::dbgNever <- function() {
	for(local i = 0; i < 2; i++) {
		drawSprite(bgSnowNever, 0, ((-camx / 8) % 720) + (i * 720), screenH() - 240)
	}
}

::dbgSnowPlainF <- function() {
	for(local i = 0; i < 2; i++) {
		drawSprite(bgSnowDusk, 0, ((-camx / 16) % 720) + (i * 720), (screenH() / 2) - 120)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgPlainill2, 0, ((-camx / 8) % 720) + (i * 720), (screenH() / 2) - 120)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgPlainHill, 0, ((-camx / 6) % 720) + (i * 720), (screenH() / 2) - 120)
	}
}

::dbgNightalt <- function() {
	for(local i = 0; i < 2; i++) {
		drawSprite(bgSnowstars2, 0, ((-camx / 16) % 720) + (i * 720), (screenH() / 2) - 120)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgStarHill, 0, ((-camx / 8) % 720) + (i * 720), (screenH() / 2) - 120)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgStarHill2, 0, ((-camx / 6) % 720) + (i * 720), (screenH() / 2) - 120)
	}
}

::dbgRace <- function() {
	drawSprite(bgRace, 0, 0, (screenH() / 2) - 120)
}


::dbgglitch <- function() {
	drawSprite(bgError, 0, 0, (screenH() / 2) - 120)
}

::dbgtropicf <- function() {
	drawSprite(bgFtropic2, 0, 0, (screenH() / 2) - 120)
	for(local i = 0; i < 2; i++) {
		drawSprite(bgFtropic0, 0, ((-camx / 32) % 720) + (i * 720), (screenH() / 2) - 120)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgFtropic, 0, ((-camx / 16) % 720) + (i * 720), (screenH() / 2) - 120)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgFtropic3, 0, ((-camx / 10) % 720) + (i * 720), (screenH() / 2) - 80)
	}
	
}
	
::dbgtropicS <- function() {
	drawSprite(bgFtropic2, 0, 0, (screenH() / 2) - 120)
	for(local i = 0; i < 2; i++) {
		drawSprite(bgFtropic0, 0, ((-camx / 32) % 720) + (i * 720), (screenH() / 2) - 120)
	}
	for(local i = 0; i < 2; i++) {
		drawSprite(bgFtropicM, 0, ((-camx / 10) % 720) + (i * 720), (screenH() / 2) - 80)
	}
	
}

::TNTALT <- class extends Actor {
	shape = null
	gothit = false
	hittime = 0.0
	frame = 0.0

	constructor(_x, _y, _arr = null) {
		base.constructor(_x, _y)

		shape = Rec(x, y, 10, 10, 0)
		tileSetSolid(x, y, 1)
	}

	function run() {
		drawSprite(sprC4, frame, x - 8 - camx, y - 8 - camy)
	}

	function _typeof() { return "TNTALT" }
}

::Spakle <- class extends Actor{
	constructor(_x, _y, _arr = null)
	{
		base.constructor(_x, _y)
	}
		function run() {
	if(getFrames() % 3 == 0){
	newActor(c1, x - 16 + randInt(32), y - 16 + randInt(100))
	}
	}
}

::c1 <- class extends Actor {
	frame = 0.0

	constructor(_x, _y, _arr = null) {
		base.constructor(_x, _y)
	}
	function run() {
		if(frame < 1) frame += 0.02
		frame += 0.05
		y -= 0.5
		if(frame >= 3) deleteActor(id)
		else drawSpriteEx(sprC1, floor(frame), x - camx, y - camy, 0, 0, 1, 1, 1)
	}
}

::Towershop <- class extends Actor {
	shape = 0
	full = true
	v = 0.0
	vspeed = 0.0
	soldout = false

	constructor(_x, _y, _arr = "") {
		base.constructor(_x, _y)

		shape = Rec(x, y + 2, 8, 8, 0)
		tileSetSolid(x, y, 1)
	}

	function run() {
		if(game.maxHealth >= 5 * 4) soldout = true
		local price = (game.maxHealth + 1) * (200)

		if(v > 0) {
			vspeed = 0
			v = 0
		}
		if(v <= -8) {
			vspeed = 0.5
		}

		if(gvPlayer) {
			if(hitTest(shape, gvPlayer.shape)) if(gvPlayer.vspeed < 0 && v == 0) if(!soldout && game.coins >= price) {
				gvPlayer.vspeed = 0
				vspeed = -1
				playSound(sndHeal, 0)
				game.health += 4
				game.maxHealth += 4
				game.coins -= price
			}
		}

		v += vspeed

		local pricetag = chint(95).tostring() + price.tostring()

		if(soldout) drawSpriteZ(2, sprBoxEmpty, getFrames() / 8, x - 8 - camx, y - 8 - camy + v)
		else {
			drawSpriteZ(2, sprBoxShop, getFrames() / 8, x - 8 - camx, y - 8 - camy + v)
			drawSpriteZ(2, sprHealth, getFrames() / 32, x - 8 - camx, y - 8 - camy + v)
			drawText(font, x - camx - (pricetag.len() * 3), y - 16 - camy, pricetag)
		}
	}
}

print("Loaded Frostlands")